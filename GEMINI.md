# Gemini CLI 設定ガイド

このファイルは、Gemini CLIがプロジェクトのコンテキストとして自動的に読み込むファイルです。

## プロジェクト概要

このプロジェクトは、SEO最適化された記事を自動生成するワークフローシステムです。
「○○について記事を作成して」と指示すると、7つのフェーズを通じて高品質な記事を生成します。

## 重要な指示

### 記事作成リクエストの処理

以下のパターンでリクエストされた場合は、必ず`INSTRUCTIONS_v2.md`のワークフローを実行してください：
- 「について記事を作成」
- 「についての記事を作成」
- 「に関する記事」
- 「のSEO記事」

### ワークフロー実行手順

1. **INSTRUCTIONS_v2.md**ファイルの内容を完全に読み込む
2. 7つのフェーズを順番に実行：
   - ステップ0: リクエスト解析
   - ステップ1: リサーチ
   - ステップ2: 構成計画
   - ステップ3: 執筆
   - ステップ3.5: ファクトチェック
   - ステップ4: 最適化
   - ステップ4.5: 画像生成（MCPサーバー使用）
   - ステップ5: 最終調整

3. **出力ディレクトリ構造**を必ず作成：
   ```
   output/YYYY-MM-DD-{title_slug}/
   ├── 00_parsed_request.json
   ├── 01_research_data.md
   ├── 02_article_structure.md
   ├── 03_draft.md
   ├── 03_5_factchecked_draft.md
   ├── 03_5_factcheck_report.json
   ├── 04_optimized_draft.html
   ├── 04_5_image_metadata.json
   ├── 04_5_with_images.html
   ├── 05_quality_report.json
   └── final.html
   ```

### 画像生成

MCPサーバー「google-ai-imagen」が利用可能な場合：
- 各H2セクションに対して画像を生成
- `generate_image`ツールを使用
- 生成した画像はHTMLに統合

### 品質基準

- ファクトチェックスコア: 90点以上
- 品質スコア: 85点以上
- これらの基準を満たさない場合は再実行

## プロジェクトファイル構造

```
/mnt/c/article-flow/
├── INSTRUCTIONS_v2.md      # メインワークフロー定義
├── config/                 # 各種設定ファイル
│   ├── workflow.yaml      # ワークフロー設定
│   ├── requirements.yaml  # 要件定義
│   ├── templates.yaml     # テンプレート
│   └── factcheck_rules.yaml # ファクトチェックルール
├── prompts/               # 各フェーズのプロンプト
│   ├── 00_parse_request.md
│   ├── 01_research.md
│   ├── 02_structure.md
│   ├── 03_writing.md
│   ├── 03_5_factcheck.md
│   ├── 04_optimization.md
│   ├── 04_5_image_generation.md
│   └── 05_finalization.md
└── assets/               # スタイルシート
    └── wordpress.css     # WordPress用CSS

## 実行例

ユーザー: 「爪ケアについて記事を作成して」

期待される動作:
1. INSTRUCTIONS_v2.mdを読み込む
2. 7フェーズのワークフローを実行
3. output/2025-07-23-nail-care/に全ファイルを保存
4. 最終的なfinal.htmlを生成

## 注意事項

- 単純な記事作成ではなく、必ずワークフローを実行すること
- 各フェーズの出力を確実に保存すること
- MCPサーバーが利用可能な場合は画像生成を実行すること
- WordPress用のインラインCSSを必ず含めること

このファイルの指示に従って、高品質な記事生成ワークフローを実行してください。


1. データベースセットアップ（Supabase）
2. 基本的なCSV読み込みとデータ投入
3. スコア計算ロジック実装（100点満点）
4. Claude API統合とフォールバック
5. フロントエンド画面作成
6. 管理画面実装
7. バッチ処理とスケジューラー設定
8. Vercelデプロイ

## 絶対に守るべき開発ルール

以下のルールは例外なく厳守すること：

1. **勝手に機能を変更しない** 
   - ユーザーが実装した機能を無断で変更・削除・無効化しない
   - 既存の動作を変える場合は必ず確認を取る
   
2. **ハードコードしない**
   - 固定値や定数をコードに直接埋め込まない
   - 設定可能な値は必ず変数や設定ファイルから読み込む
   - 例: スコア設定の重み、ポイント上限、表示テキストなど
   
3. **一時的な対処をしない**
   - その場しのぎの修正や暫定対応は行わない
   - 根本的な解決策を実装する
   - TODO や FIXME を残さない

4. **作業記録の徹底**
   - 大きな修正を実施した後は必ず `memory_bank/` にレポートを残す
   - フォーマット: `yyyy-mm-dd_機能名.md`
   - 記録内容: 問題の詳細、原因、実施した修正、影響範囲、成果

5. **タスク開始前の確認**
   - 作業開始前に必ず `memory_bank/` の過去の実装ログを確認
   - 関連する過去の修正内容を把握してから作業を開始
   - 同じ問題の再発を防ぐため

6. **他機能への影響を最小化**
   - 修正を行う際は、他の機能に影響を与えないよう細心の注意を払う
   - 影響範囲を明確に把握してから実装
   - テストで動作確認を徹底

7. **影響の大きい修正は事前確認**
   - 他の機能に影響する可能性がある修正は、実施前に必ずユーザーに確認を取る
   - 影響範囲と修正内容を明確に説明
   - 承認を得てから実装を開始

この指示書に従って、システムの実装・保守を行ってください。

## Gemini CLI 連携ガイド

### 目的
ユーザーが **「Geminiと相談しながら進めて」** （または同義語）と指示した場合、Claude は以降のタスクを **Gemini CLI** と協調しながら進める。
Gemini から得た回答はそのまま提示し、Claude 自身の解説・統合も付け加えることで、両エージェントの知見を融合する。

---

### トリガー
- 正規表現: `/Gemini.*相談しながら/`
- 例:
- 「Geminiと相談しながら進めて」
- 「この件、Geminiと話しつつやりましょう」

---

### 基本フロー
1. **PROMPT 生成**
Claude はユーザーの要件を 1 つのテキストにまとめ、環境変数 `$PROMPT` に格納する。

2. **Gemini CLI 呼び出し**
```bash
gemini <<EOF
$PROMPT
EOF