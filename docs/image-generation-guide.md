# Gemini CLI画像生成機能 実装ガイド

## 概要
このガイドでは、SEO記事生成ワークフローにGemini 2.0の画像生成機能を統合する方法を説明します。

## 前提条件

### 必要な環境
- Gemini CLI（最新版）がインストール済み
- 画像生成機能が有効なGeminiアカウント

**注意**: Gemini CLIは内蔵の画像生成機能を持っているため、別途APIキーの設定は不要です。

## 使用方法

### 基本的な記事生成（画像付き）
```bash
# Gemini CLIで実行
gemini "爪ケアについての記事を作成して"

# 画像生成を明示的に有効化
gemini "爪ケアについての記事を作成して" --generate-images
```

### 詳細なパラメータ指定
```bash
gemini "爪ケアについての記事を作成して" \
  --generate-images \
  --image-style "professional, medical illustration" \
  --store-url "https://example.com" \
  --target "30代女性"
```

## ワークフローの動作

### 1. 通常の記事生成フェーズ（ステップ0-4）
- リクエスト解析
- リサーチ（15-25回のWeb検索）
- 構成計画
- 本文執筆
- ファクトチェック
- SEO最適化

### 2. 画像生成フェーズ（ステップ4.5）新規追加

#### 2.1 セクション分析
各H2セクションに対して：
- コンテンツの核心メッセージを抽出
- 最適な画像タイプを決定（写真風/図解/概念図）
- SEO要件を考慮

#### 2.2 プロンプト生成
```json
{
  "style": "プロフェッショナル、清潔、信頼感",
  "subject": "爪の正しいケア方法",
  "composition": "ステップバイステップの手順",
  "mood": "明るく親しみやすい",
  "avoid": "テキスト、ロゴ、複雑な背景"
}
```

#### 2.3 Gemini CLI内蔵機能での画像生成
Gemini CLIが内部的に画像生成を処理します：
- プロンプトに基づいて自動的に画像を生成
- 生成された画像は指定のディレクトリに保存
- API呼び出しは不要（CLIが内部で処理）

#### 2.4 画像最適化
- WebP形式に変換
- 800x600pxにリサイズ
- ファイルサイズを200KB以下に圧縮
- SEO最適化されたファイル名を付与

### 3. 最終調整フェーズ（ステップ5）
- 画像を含む完全なHTMLを生成
- 品質スコアの再計算

## 出力構造

```
output/
├── 2025-01-23-nail-care/
│   ├── final.html              # 画像を含む最終HTML
│   ├── images/
│   │   ├── nail-care-basics-01.webp
│   │   ├── nail-care-methods-01.webp
│   │   ├── nail-care-tools-01.webp
│   │   └── ...
│   ├── image_metadata.json     # 画像生成の詳細情報
│   └── process_log.json        # 処理ログ
```

## 画像生成の品質管理

### 自動チェック項目
1. **コンテンツ適合性**
   - セクション内容との一致
   - キーワードとの関連性

2. **技術的品質**
   - 解像度とファイルサイズ
   - フォーマットの適切性

3. **SEO最適化**
   - alt属性の充実度
   - ファイル名の記述性

### 人間によるレビュー推奨項目
1. **ブランド整合性**
   - 店舗イメージとの調和
   - プロフェッショナルな印象

2. **法的コンプライアンス**
   - 薬機法・景表法への準拠
   - 著作権・商標の問題

3. **文化的配慮**
   - 多様性への配慮
   - 不適切な表現の有無

## トラブルシューティング

### 画像生成の制限
```
Error: Image generation limit reached
```
**対処法**: 
- Geminiアカウントの画像生成制限を確認
- 必要に応じてプランをアップグレード

### 画像生成失敗
```
Error: Image generation failed
```
**対処法**:
- プロンプトの安全性を確認
- より具体的で安全な表現に修正

### ファイルサイズ超過
```
Warning: Image size exceeds 200KB
```
**対処法**:
- 品質設定を調整（85→80）
- 画像の複雑さを削減

## ベストプラクティス

### 1. プロンプト作成のコツ
- 具体的で明確な指示
- ポジティブな表現（「〜しない」より「〜する」）
- スタイルと雰囲気を明確に

### 2. SEO最適化
- メインキーワードをalt属性に含める
- 記述的なファイル名を使用
- 画像周辺のテキストとの関連性

### 3. パフォーマンス
- レイジーローディングの活用
- 適切な圧縮率の選択
- CDNの活用を検討

## 設定のカスタマイズ

### .gemini-cli-config.yaml
```yaml
gemini_settings:
  image_generation:
    enabled: true
    model: "gemini-2.0-flash-preview-image-generation"
    images_per_h2: 1        # 各H2に生成する画像数
    quality: "hd"           # 画質設定
    style: "professional"   # デフォルトスタイル
    max_retries: 3          # 失敗時のリトライ回数
```

### config/workflow.yaml
```yaml
image_generation:
  settings:
    generate_variations: 2  # 各画像のバリエーション数
    auto_select: true      # 自動選択の有効化
    quality_threshold: 70  # 最低品質スコア
```

## 今後の拡張可能性

1. **A/Bテスト機能**
   - 複数の画像バリエーションをテスト
   - CTRの測定と最適化

2. **カスタムスタイル**
   - 店舗ブランドに合わせたスタイル定義
   - 業界別のプリセット

3. **画像編集機能**
   - 生成後の微調整
   - ブランド要素の追加

## まとめ

Gemini CLIの画像生成機能により、SEO記事の品質と視覚的魅力が大幅に向上します。
適切な設定と品質管理により、プロフェッショナルな記事を効率的に生成できます。