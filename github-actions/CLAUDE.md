# Claude Code プロジェクトガイドライン

## プロジェクト概要
これは高品質なSEO最適化記事を自動生成するGitHub Actionsワークフローです。Claude Code ActionとGemini APIを統合し、リサーチから記事生成、画像作成、Google Driveへのアップロードまでを完全自動化します。

## コードスタイルガイド

### Python
- PEP 8準拠
- 型ヒントを使用
- エラーハンドリングは明示的に
- ログ出力はGitHub Actions形式で

### YAML (GitHub Actions)
- インデントは2スペース
- ジョブ名は明確で説明的に
- シークレットは必ず`${{ secrets.KEY_NAME }}`形式で

## アーキテクチャ

### フェーズ構成
1. **リクエスト解析** - 記事パラメータの抽出と検証
2. **リサーチ** - Gemini APIによる実Web検索（15-25クエリ）
3. **構成計画** - エビデンスベースの記事構造作成
4. **執筆** - 3200±300字の記事生成
5. **ファクトチェック** - 事実検証（目標90点以上）
6. **SEO最適化** - HTML変換とメタデータ生成
7. **最終調整** - 品質チェック（目標85点以上）

### 使用API
- **Claude Code Action**: メイン記事生成エンジン
- **Gemini API**: Web検索（google_searchツール）と画像生成（Imagen）
- **Google Drive API**: 成果物のアップロード

## 品質基準

### 記事品質
- オリジナリティ: 100%
- キーワード密度: 2.5-3.5%
- 禁止事項:
  - 絶対的表現（必ず、100%、絶対に）
  - 曖昧表現
  - 誇大表現
  - 医療・健康に関する断定的主張

### 情報源の優先順位
1. **最優先**: 政府機関（.go.jp, .gov）
2. **高優先**: 学術機関（.ac.jp, .edu）、医学会
3. **中優先**: 業界団体、大手メディア

## エラーハンドリング

### リトライ戦略
- 各フェーズ最大3回リトライ
- 待機時間: 30秒
- タイムアウト: 各フェーズ10-15分

### 失敗時の対応
- 部分的成功の場合、成功部分を保存
- 詳細なエラーログをGitHub Actions形式で出力
- 管理者への通知（Slack Webhook設定時）

## セキュリティ

### APIキー管理
- すべてのAPIキーはGitHub Secretsで管理
- 環境変数経由でのみアクセス
- ログ出力時はマスキング

### データ保護
- 生成コンテンツの暗号化転送
- Google Driveの適切な共有設定
- 個人情報の自動検出と除外

## パフォーマンス目標

### 処理時間
- 全体: 30-45分/記事
- 各フェーズ: 最大10-15分

### 成功率
- フェーズ成功率: 95%以上
- 画像生成成功率: 98%以上

### コスト
- 目標: $0.60以下/記事
- 内訳:
  - Claude API: $0.30-0.50
  - Gemini API: $0.05-0.10
  - その他: $0.05

## トラブルシューティング

### よくある問題
1. **Gemini検索エラー**: API制限確認、レート制限対応
2. **画像生成失敗**: Imagen APIステータス確認
3. **Drive アップロード失敗**: 認証情報とフォルダ権限確認

### デバッグ方法
- GitHub Actionsログの確認
- 各フェーズの出力JSONファイル確認
- エラーアノテーションの確認

## 更新とメンテナンス

### プロンプト更新
- `prompts/`ディレクトリ内のMarkdownファイルを編集
- バージョン管理で変更履歴を記録

### 設定変更
- `config/`ディレクトリ内のYAMLファイルを編集
- 本番環境への反映前にステージングでテスト

## コミュニケーション

### コメント形式
- 進捗報告は簡潔に
- エラーは具体的な原因と対策を含める
- 成功時は主要メトリクスを報告

### レビュー基準
- コード品質
- セキュリティ
- パフォーマンス
- コスト効率

---

このガイドラインに従って、高品質で信頼性の高い記事生成システムを維持してください。

## 絶対に守るべき開発ルール

以下のルールは例外なく厳守すること：

1. **勝手に機能を変更しない** 
   - ユーザーが実装した機能を無断で変更・削除・無効化しない
   - 既存の動作を変える場合は必ず確認を取る
   
2. **ハードコードしない**
   - 固定値や定数をコードに直接埋め込まない
   - 設定可能な値は必ず変数や設定ファイルから読み込む
   - 例: スコア設定の重み、ポイント上限、表示テキストなど
   
3. **一時的な対処をしない**
   - その場しのぎの修正や暫定対応は行わない
   - 根本的な解決策を実装する
   - TODO や FIXME を残さない

4. **作業記録の徹底**
   - 大きな修正を実施した後は必ず `memory_bank/` にレポートを残す
   - フォーマット: `yyyy-mm-dd_機能名.md`
   - 記録内容: 問題の詳細、原因、実施した修正、影響範囲、成果

5. **タスク開始前の確認**
   - 作業開始前に必ず `memory_bank/` の過去の実装ログを確認
   - 関連する過去の修正内容を把握してから作業を開始
   - 同じ問題の再発を防ぐため

6. **他機能への影響を最小化**
   - 修正を行う際は、他の機能に影響を与えないよう細心の注意を払う
   - 影響範囲を明確に把握してから実装
   - テストで動作確認を徹底

7. **影響の大きい修正は事前確認**
   - 他の機能に影響する可能性がある修正は、実施前に必ずユーザーに確認を取る
   - 影響範囲と修正内容を明確に説明
   - 承認を得てから実装を開始

この指示書に従って、システムの実装・保守を行ってください。

## Gemini CLI 連携ガイド

### 目的
ユーザーが **「Geminiと相談しながら進めて」** （または同義語）と指示した場合、Claude は以降のタスクを **Gemini CLI** と協調しながら進める。
Gemini から得た回答はそのまま提示し、Claude 自身の解説・統合も付け加えることで、両エージェントの知見を融合する。

---

### トリガー
- 正規表現: `/Gemini.*相談しながら/`
- 例:
- 「Geminiと相談しながら進めて」
- 「この件、Geminiと話しつつやりましょう」

---

### 基本フロー
1. **PROMPT 生成**
Claude はユーザーの要件を 1 つのテキストにまとめ、環境変数 `$PROMPT` に格納する。

2. **Gemini CLI 呼び出し**
```bash
gemini <<EOF
$PROMPT
EOF